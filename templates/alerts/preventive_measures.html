{% extends 'base.html' %}
{% load static %}

{% block title %}Preventive Measures - Pest & Disease Risk Prediction{% endblock %}

{% block content %}
<div class="preventive-measures-page">
    <h1><i class="fas fa-shield-alt"></i> Preventive Measures Database</h1>
    
    <!-- Filters -->
    <div class="card mb-3">
        <div class="card-body">
            <form method="get" class="flex gap-2">
                <div class="form-group" style="flex: 1; margin-bottom: 0;">
                    <select name="pest" class="form-control">
                        <option value="">All Pests</option>
                        {% for pest in pests %}
                            <option value="{{ pest.pk }}" {% if selected_pest == pest.pk|stringformat:"s" %}selected{% endif %}>
                                {{ pest.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group" style="flex: 0 0 200px; margin-bottom: 0;">
                    <select name="effectiveness" class="form-control">
                        <option value="">All Effectiveness</option>
                        <option value="HIGH" {% if selected_effectiveness == 'HIGH' %}selected{% endif %}>High</option>
                        <option value="MEDIUM" {% if selected_effectiveness == 'MEDIUM' %}selected{% endif %}>Medium</option>
                        <option value="LOW" {% if selected_effectiveness == 'LOW' %}selected{% endif %}>Low</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Filter</button>
                {% if selected_pest or selected_effectiveness %}
                    <a href="{% url 'alerts:preventive_measures' %}" class="btn btn-outline">
                        <i class="fas fa-times"></i> Clear
                    </a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <!-- Measures Grid -->
    <div class="grid grid-3">
        {% for measure in measures %}
            <div class="card">
                <div class="card-header flex-between">
                    <span><i class="fas fa-bug"></i> {{ measure.pest.name }}</span>
                    <span class="badge-pill badge-{% if measure.effectiveness == 'HIGH' %}success{% elif measure.effectiveness == 'MEDIUM' %}warning{% else %}info{% endif %}">
                        {{ measure.get_effectiveness_display }}
                    </span>
                </div>
                <div class="card-body">
                    <h4 style="margin-bottom: 1rem; color: var(--primary-color);">{{ measure.measure_type }}</h4>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">{{ measure.description }}</p>
                    
                    <div style="padding: 0.75rem; background: var(--bg-primary); border-radius: 8px; margin-bottom: 1rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <span style="color: var(--text-muted); font-size: 0.85rem;">Timing:</span>
                            <strong style="margin-left: 0.5rem;">{{ measure.timing }}</strong>
                        </div>
                        <div>
                            <span style="color: var(--text-muted); font-size: 0.85rem;">Cost:</span>
                            <strong style="margin-left: 0.5rem;">{{ measure.get_cost_display }}</strong>
                        </div>
                    </div>
                    
                    {% if measure.application_method %}
                        <div style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid var(--success-color);">
                            <h5 style="color: var(--success-color); margin-bottom: 0.5rem; font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> Application Method
                            </h5>
                            <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">
                                {{ measure.application_method }}
                            </p>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <div class="card" style="grid-column: 1 / -1;">
                <div class="card-body" style="text-align: center; padding: 4rem;">
                    <i class="fas fa-shield-alt" style="font-size: 4rem; color: var(--text-muted); opacity: 0.3; margin-bottom: 1.5rem;"></i>
                    <h3 style="color: var(--text-muted); margin-bottom: 0.5rem;">No Preventive Measures Found</h3>
                    <p style="color: var(--text-muted);">No measures match your current filters.</p>
                </div>
            </div>
        {% endfor %}
    </div>
    
    <div class="flex gap-2 mt-3">
        <a href="{% url 'alerts:alert_list' %}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Back to Alerts
        </a>
        <a href="{% url 'dashboard:home' %}" class="btn btn-secondary">
            <i class="fas fa-home"></i> Dashboard
        </a>
    </div>
</div>
{% endblock %}
